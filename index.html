<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ARELEI ¬∑ –£–º–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    :root {
      --bg1: #f8fafc;
      --bg2: #f5f5f7;
      --glass-light: rgba(255, 255, 255, 0.72);
      --glass-strong: rgba(255, 255, 255, 0.88);
      --border-glass: rgba(255, 255, 255, 0.7);
      --primary: #007aff; /* Apple —Å–∏–Ω–∏–π */
      --primary-soft: rgba(0, 122, 255, 0.12);
      --accent-pink: #ff2d55;
      --text-main: #1c1c1e;
      --text-muted: #8e8e93;
      --radius-lg: 22px;
      --radius-md: 16px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.24);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: radial-gradient(circle at top, #fef6ff 0, #f5fbff 40%, #f5f5f7 100%);
      color: var(--text-main);
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 430px;
      height: 100vh;
      padding: env(safe-area-inset-top) 14px calc(68px + env(safe-area-inset-bottom)) 14px;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* –ª—ë–≥–∫–æ–µ —Å–∏—è–Ω–∏–µ –ø–æ–∑–∞–¥–∏ ‚Äú–∞–π—Ñ–æ–Ω–∞‚Äù */
    .app::before {
      content: "";
      position: absolute;
      inset: 0;
      margin: auto;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.9), rgba(0, 122, 255, 0.13), transparent 70%);
      filter: blur(4px);
      opacity: 0.9;
      z-index: -1;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 4px 8px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-wrap {
      width: 34px;
      height: 34px;
      border-radius: 14px;
      background: conic-gradient(from 200deg, rgba(0, 122, 255, 0.15), rgba(255, 45, 85, 0.2), rgba(52, 199, 89, 0.2), rgba(0, 122, 255, 0.15));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.18);
    }

    .logo-circle {
      width: 28px;
      height: 28px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 20%, #ffffff, #f2f2f7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 16px;
      font-weight: 800;
    }

    .brand-text-title {
      font-weight: 700;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .brand-text-title span.emoji {
      font-size: 18px;
    }

    .brand-text-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .tg-user {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--glass-light);
      border: 1px solid var(--border-glass);
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.16);
      font-size: 10px;
      backdrop-filter: blur(22px);
      -webkit-backdrop-filter: blur(22px);
    }

    .tg-avatar {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), #5ac8fa);
      color: #fff;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .tg-name {
      font-weight: 500;
    }

    .tg-tag {
      color: var(--text-muted);
      font-size: 9px;
    }

    .badge-status {
      margin: 0 4px 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 11px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.7);
      color: #0f5132;
      font-size: 10px;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.18);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #34c759;
      box-shadow: 0 0 0 4px rgba(52, 199, 89, 0.2);
    }

    #screen {
      flex: 1;
      overflow-y: auto;
      padding: 4px 2px 8px;
      font-size: 13px;
    }

    #screen::-webkit-scrollbar {
      width: 4px;
    }

    #screen::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 999px;
    }

    .card {
      background: var(--glass-light);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-glass);
      box-shadow: var(--shadow-soft);
      padding: 12px 14px 14px;
      margin-bottom: 10px;
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 7px;
      font-weight: 600;
      font-size: 13px;
    }

    .card-title span {
      font-size: 18px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
      transition: 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #5ac8fa);
      color: #fff;
      box-shadow: 0 12px 26px rgba(0, 122, 255, 0.6);
    }

    .btn-primary:active {
      transform: scale(0.97);
      box-shadow: 0 7px 16px rgba(0, 122, 255, 0.7);
    }

    .btn-ghost {
      background: rgba(255, 255, 255, 0.85);
      color: #1c1c1e;
      border: 1px solid rgba(255, 255, 255, 0.9);
    }

    .btn-ghost:active {
      transform: scale(0.97);
      box-shadow: 0 5px 14px rgba(15, 23, 42, 0.18);
    }

    .btn-sm {
      padding: 6px 11px;
      font-size: 10px;
    }

    .notes {
      font-size: 10.5px;
      color: var(--text-muted);
      margin-top: 5px;
      line-height: 1.4;
    }

    .inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 8px;
    }

    label {
      display: block;
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    select,
    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 7px 9px;
      border-radius: 12px;
      border: 1px solid rgba(120, 120, 128, 0.16);
      font-size: 11px;
      background: rgba(248, 248, 250, 0.95);
      color: var(--text-main);
      outline: none;
    }

    select:focus,
    input[type="text"]:focus,
    input[type="number"]:focus {
      border-color: rgba(0, 122, 255, 0.6);
      box-shadow: 0 0 0 1px rgba(0, 122, 255, 0.2);
      background: #ffffff;
    }

    .stat-row {
      display: flex;
      gap: 8px;
      margin-top: 6px;
    }

    .stat {
      flex: 1;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      padding: 7px 9px;
      font-size: 10px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
    }

    .stat-label {
      color: var(--text-muted);
      font-size: 9px;
      margin-bottom: 2px;
    }

    .stat-value {
      font-weight: 600;
      font-size: 15px;
    }

    .stat-note {
      font-size: 9px;
      color: #34c759;
      margin-top: 1px;
    }

    .ai-block {
      margin-top: 8px;
      padding: 8px 9px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.95);
      font-size: 11px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
    }

    .ai-label {
      font-size: 9px;
      color: var(--text-muted);
      margin-bottom: 3px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .ai-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .ai-title span {
      font-size: 16px;
    }

    .ai-text {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
      margin-bottom: 4px;
    }

    .ai-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .ai-tag {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0, 122, 255, 0.08);
      color: #004a99;
    }

    .quick-row {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 7px;
      margin-top: 8px;
    }

    .quick {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      padding: 7px 5px;
      font-size: 10px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: 0.15s ease;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.14);
    }

    .quick span.icon {
      font-size: 18px;
    }

    .quick:active {
      transform: scale(0.96);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.2);
    }

    .clothes-list {
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-top: 6px;
    }

    .clothes-item {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.95);
      padding: 7px 9px;
      font-size: 11px;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.14);
    }

    .item-image {
      width: 50px;
      height: 50px;
      flex-shrink: 0;
      border-radius: 12px;
      background: #e5e5ea;
      object-fit: cover;
    }

    .clothes-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .clothes-name {
      font-weight: 500;
    }

    .clothes-meta {
      font-size: 10px;
      color: var(--text-muted);
    }

    .chip {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 9px;
      background: rgba(242, 242, 247, 0.9);
      color: #3a3a3c;
    }

    .badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(52, 199, 89, 0.12);
      color: #0f5132;
    }

    .ar-video,
    .ar-photo {
      width: 100%;
      border-radius: 18px;
      background: #000;
      max-height: 260px;
      object-fit: cover;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.45);
    }

    .upload-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    input[type="file"] {
      font-size: 9px;
    }

    .discounts {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
      font-size: 10px;
    }

    .discount-card {
      border-radius: 16px;
      padding: 8px 9px;
      background: rgba(240, 249, 255, 0.96);
      border: 1px solid rgba(191, 219, 254, 0.9);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: 0.15s ease;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.16);
    }

    .discount-card:active {
      transform: scale(0.97);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.2);
    }

    .discount-brand {
      font-weight: 600;
      font-size: 11px;
    }

    .discount-info {
      color: #0f4c75;
      font-size: 10px;
    }

    .badge-link {
      font-size: 9px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #084c61;
      color: #e0f2fe;
    }

    .bottom-nav {
      position: absolute;
      left: 14px;
      right: 14px;
      bottom: 10px;
      padding: 8px 10px;
      background: rgba(22, 22, 24, 0.88);
      border-radius: 999px;
      display: flex;
      justify-content: space-between;
      gap: 4px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }

    .tab-btn {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: rgba(235, 235, 245, 0.7);
      font-size: 10px;
      padding: 5px 0 2px;
      border-radius: 999px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      transition: 0.15s ease;
    }

    .tab-btn span.icon {
      font-size: 18px;
    }

    .tab-btn.active {
      background: rgba(242, 242, 247, 1);
      color: #111827;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.55);
    }

    .tab-btn.pro::after {
      content: "PRO";
      font-size: 7.5px;
      padding: 1px 5px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent-pink), #ff9f0a);
      color: #fff;
      margin-top: -1px;
    }

    .pill {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255, 149, 0, 0.14);
      color: #783506;
      font-size: 9px;
    }

    /* –û–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */

    .steps {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-size: 10px;
      color: var(--text-muted);
    }

    .step-dots {
      display: inline-flex;
      gap: 4px;
    }

    .step-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(199, 199, 204, 0.6);
    }

    .step-dot.active {
      width: 18px;
      background: linear-gradient(135deg, var(--primary), #5ac8fa);
      box-shadow: 0 6px 16px rgba(0, 122, 255, 0.5);
    }

    .onb-emoji {
      font-size: 38px;
      margin-bottom: 4px;
    }

    .onb-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.01em;
      margin-bottom: 4px;
    }

    .onb-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .onb-buttons {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 10px;
    }

    .onb-buttons .btn {
      flex: 1;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo-wrap">
          <div class="logo-circle">A</div>
        </div>
        <div>
          <div class="brand-text-title">
            <span class="emoji">üëó</span> ARELEI
          </div>
          <div class="brand-text-sub">–£–º–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–± —Å AR –∏ –ò–ò-—Å—Ç–∏–ª–∏—Å—Ç–æ–º</div>
        </div>
      </div>
      <div class="tg-user">
        <div class="tg-avatar" id="tgAvatar">A</div>
        <div>
          <div class="tg-name" id="tgName">–ì–æ—Å—Ç—å</div>
          <div class="tg-tag">Telegram –∞–∫–∫–∞—É–Ω—Ç</div>
        </div>
      </div>
    </header>

    <div class="badge-status" id="statusBadge">
      <div class="badge-dot"></div>
      Free-–ø–ª–∞–Ω ¬∑ –ò–ò-—Å—Ç–∏–ª–∏—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ ü§ñ
    </div>

    <div id="screen">
      –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...
    </div>

    <div class="bottom-nav">
      <button class="tab-btn active" data-tab="home" onclick="setTab('home')">
        <span class="icon">üè†</span>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
      </button>
      <button class="tab-btn" data-tab="wardrobe" onclick="setTab('wardrobe')">
        <span class="icon">üëö</span>
        <span>–ì–∞—Ä–¥–µ—Ä–æ–±</span>
      </button>
      <button class="tab-btn" data-tab="ar" onclick="setTab('ar')">
        <span class="icon">üì∑</span>
        <span>AR</span>
      </button>
      <button class="tab-btn" data-tab="stylist" onclick="setTab('stylist')">
        <span class="icon">ü§ñ</span>
        <span>–°—Ç–∏–ª–∏—Å—Ç</span>
      </button>
      <button class="tab-btn pro" data-tab="pro" onclick="setTab('pro')">
        <span class="icon">üíé</span>
        <span>PRO</span>
      </button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "arelei-data-v2";

    const state = {
      tab: "home",
      pro: false,
      onboarded: false,
      onboardingStep: 1, // 1..3
      profile: {
        age: null,
        city: "",
        goal: ""
      },
      clothes: [],
      discounts: [
        {
          brand: "OZON ¬∑ BrandX",
          offer: "-15% –Ω–∞ –∫–∞–ø—Å—É–ª—É ¬´–û—Å–µ–Ω—å¬ª",
          note: "–¥–ª—è PRO-–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ üåü"
        },
        {
          brand: "Wildberries ¬∑ UrbanWear",
          offer: "-10% –Ω–∞ –±–∞–∑–æ–≤—ã–µ –¥–∂–∏–Ω—Å—ã",
          note: "–ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º —Å—Ç–∏–ª–∏—Å—Ç–∞ üëñ"
        }
      ]
    };

    let arStream = null;

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        if (Array.isArray(data.clothes)) state.clothes = data.clothes;
        if (typeof data.pro === "boolean") state.pro = data.pro;
        if (typeof data.onboarded === "boolean") state.onboarded = data.onboarded;
        if (data.profile) state.profile = data.profile;
      } catch (e) {
        console.error(e);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(
          STORAGE_KEY,
          JSON.stringify({
            clothes: state.clothes,
            pro: state.pro,
            onboarded: state.onboarded,
            profile: state.profile
          })
        );
      } catch (e) {
        console.error(e);
      }
    }

    function setTab(tab) {
      if (!state.onboarded && tab !== "home") {
        alert("–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥—ë–º –Ω–µ–±–æ–ª—å—à–æ–π –∫–≤–∏–∑-–Ω–∞—Å—Ç—Ä–æ–π–∫—É üôÇ");
        state.tab = "home";
        highlightTab("home");
        renderOnboarding(document.getElementById("screen"));
        return;
      }

      state.tab = tab;
      highlightTab(tab);
      renderScreen();
    }

    function highlightTab(tab) {
      document
        .querySelectorAll(".tab-btn")
        .forEach(btn => btn.classList.toggle("active", btn.dataset.tab === tab));
    }

    function renderScreen() {
      const root = document.getElementById("screen");
      if (!state.onboarded) {
        renderOnboarding(root);
        return;
      }
      if (state.tab === "home") renderHome(root);
      else if (state.tab === "wardrobe") renderWardrobe(root);
      else if (state.tab === "ar") renderAR(root);
      else if (state.tab === "stylist") renderStylist(root);
      else if (state.tab === "pro") renderPro(root);
    }

    /* ====== –û–ù–ë–û–†–î–ò–ù–ì: 3 –°–õ–ê–ô–î–ê ====== */

    function renderOnboarding(root) {
      const step = state.onboardingStep;
      let inner = "";

      if (step === 1) {
        inner = `
          <div class="onb-emoji">‚ú®</div>
          <div class="onb-title">–î–∞–≤–∞–π –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è</div>
          <div class="onb-sub">
            ARELEI –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–æ–≤–µ—Ç—ã –ø–æ–¥ —Ç–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç, —à–∫–æ–ª—É/—É—á—ë–±—É –∏–ª–∏ —Ä–∞–±–æ—Ç—É.
          </div>
          <div class="inputs">
            <div>
              <label for="ageInput">–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç?</label>
              <input id="ageInput" type="number" min="7" max="80" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 15" value="${state.profile.age || ""}" />
            </div>
          </div>
          <div class="onb-buttons">
            <button class="btn btn-ghost btn-sm" onclick="skipOnboarding()">
              –ü–æ–∑–∂–µ
            </button>
            <button class="btn btn-primary btn-sm" onclick="nextOnboardingStep()">
              –î–∞–ª–µ–µ ‚Üí
            </button>
          </div>
        `;
      } else if (step === 2) {
        inner = `
          <div class="onb-emoji">üéØ</div>
          <div class="onb-title">–ó–∞—á–µ–º —Ç–µ–±–µ ARELEI?</div>
          <div class="onb-sub">
            –¢–∞–∫ —Å—Ç–∏–ª–∏—Å—Ç –ø–æ–π–º—ë—Ç, –Ω–∞ —á—ë–º –¥–µ–ª–∞—Ç—å –∞–∫—Ü–µ–Ω—Ç: —Å—Ç–∏–ª—å, —à–∫–æ–ª–∞, —Ä–∞–±–æ—Ç–∞ –∏–ª–∏ —ç–∫–æ–Ω–æ–º–∏—è.
          </div>
          <div class="inputs">
            <div>
              <label for="goalSelect">–í—ã–±–µ—Ä–∏ —Ü–µ–ª—å</label>
              <select id="goalSelect">
                <option value="">–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                <option value="school" ${state.profile.goal === "school" ? "selected" : ""}>
                  –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—å–Ω—ã–π / —É—á–µ–±–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±
                </option>
                <option value="style" ${state.profile.goal === "style" ? "selected" : ""}>
                  –ù–∞—É—á–∏—Ç—å—Å—è –ø–æ–¥–±–∏—Ä–∞—Ç—å —Å—Ç–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã
                </option>
                <option value="save" ${state.profile.goal === "save" ? "selected" : ""}>
                  –ú–µ–Ω—å—à–µ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –≤–µ—â–∏ / —Ä–∞–∑—É–º–Ω—ã–π —à–æ–ø–∏–Ω–≥
                </option>
                <option value="work" ${state.profile.goal === "work" ? "selected" : ""}>
                  –°–æ–±—Ä–∞—Ç—å –≥–∞—Ä–¥–µ—Ä–æ–± –¥–ª—è —Ä–∞–±–æ—Ç—ã
                </option>
              </select>
            </div>
          </div>
          <div class="onb-buttons">
            <button class="btn btn-ghost btn-sm" onclick="prevOnboardingStep()">
              ‚Üê –ù–∞–∑–∞–¥
            </button>
            <button class="btn btn-primary btn-sm" onclick="nextOnboardingStep()">
              –î–∞–ª–µ–µ ‚Üí
            </button>
          </div>
        `;
      } else if (step === 3) {
        inner = `
          <div class="onb-emoji">üå¶Ô∏è</div>
          <div class="onb-title">–ì–¥–µ —Ç—ã –∂–∏–≤—ë—à—å?</div>
          <div class="onb-sub">
            –ì–æ—Ä–æ–¥ –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞—Ç—å –ø–æ–≥–æ–¥—É –∏ —Å–µ–∑–æ–Ω, –∫–æ–≥–¥–∞ –ø–æ–¥–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑—ã.
          </div>
          <div class="inputs">
            <div>
              <label for="cityInput">–ì–æ—Ä–æ–¥</label>
              <input id="cityInput" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ú–æ—Å–∫–≤–∞" value="${state.profile.city || ""}" />
            </div>
          </div>
          <div class="onb-buttons">
            <button class="btn btn-ghost btn-sm" onclick="prevOnboardingStep()">
              ‚Üê –ù–∞–∑–∞–¥
            </button>
            <button class="btn btn-primary btn-sm" onclick="completeOnboarding()">
              –ó–∞–≤–µ—Ä—à–∏—Ç—å ‚úì
            </button>
          </div>
        `;
      }

      root.innerHTML = `
        <div class="card">
          <div class="steps">
            <div>–®–∞–≥ ${step} –∏–∑ 3</div>
            <div class="step-dots">
              <div class="step-dot ${step === 1 ? "active" : ""}"></div>
              <div class="step-dot ${step === 2 ? "active" : ""}"></div>
              <div class="step-dot ${step === 3 ? "active" : ""}"></div>
            </div>
          </div>
          ${inner}
        </div>
      `;
    }

    function nextOnboardingStep() {
      if (state.onboardingStep === 1) {
        const ageEl = document.getElementById("ageInput");
        const age = parseInt(ageEl.value, 10);
        if (!age || age < 7 || age > 80) {
          alert("–í–≤–µ–¥–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–µ–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (–æ—Ç 7 –¥–æ 80).");
          return;
        }
        state.profile.age = age;
      } else if (state.onboardingStep === 2) {
        const goalEl = document.getElementById("goalSelect");
        const goal = goalEl.value;
        if (!goal) {
          alert("–í—ã–±–µ—Ä–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ü–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ARELEI.");
          return;
        }
        state.profile.goal = goal;
      }

      if (state.onboardingStep < 3) {
        state.onboardingStep += 1;
        renderOnboarding(document.getElementById("screen"));
      }
    }

    function prevOnboardingStep() {
      if (state.onboardingStep > 1) {
        state.onboardingStep -= 1;
        renderOnboarding(document.getElementById("screen"));
      }
    }

    function skipOnboarding() {
      if (!confirm("–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É? –°–æ–≤–µ—Ç—ã —Å—Ç–∏–ª–∏—Å—Ç–∞ –±—É–¥—É—Ç –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º–∏.")) return;
      state.onboarded = true;
      saveState();
      setTab("home");
    }

    function completeOnboarding() {
      const cityEl = document.getElementById("cityInput");
      const city = cityEl.value.trim();
      if (!city) {
        alert("–í–≤–µ–¥–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≥–æ—Ä–æ–¥.");
        return;
      }
      state.profile.city = city;
      state.onboarded = true;
      saveState();
      setTab("home");
    }

    function goalToText(goal) {
      if (goal === "school") return "—à–∫–æ–ª—å–Ω—ã–π / —É—á–µ–±–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±";
      if (goal === "style") return "—Å—Ç–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã";
      if (goal === "save") return "—Ä–∞–∑—É–º–Ω—ã–π —à–æ–ø–∏–Ω–≥";
      if (goal === "work") return "–≥–∞—Ä–¥–µ—Ä–æ–± –¥–ª—è —Ä–∞–±–æ—Ç—ã";
      return "";
    }

    /* ====== –ì–õ–ê–í–ù–ê–Ø ====== */

    function renderHome(root) {
      const total = state.clothes.length;
      let profileLine = "";
      if (state.profile && state.profile.age && state.profile.city) {
        const ctx =
          state.profile.age >= 7 && state.profile.age <= 17
            ? "—Ñ–æ–∫—É—Å –Ω–∞ —à–∫–æ–ª–µ / –∫–æ–ª–ª–µ–¥–∂–µ"
            : "—Ñ–æ–∫—É—Å –Ω–∞ —É—á—ë–±–µ / —Ä–∞–±–æ—Ç–µ";
        profileLine = `
          <div class="notes">
            –ü—Ä–æ—Ñ–∏–ª—å: <b>${state.profile.age}</b> –ª–µ—Ç ¬∑ ${state.profile.city} ¬∑ —Ü–µ–ª—å ‚Äî ${goalToText(
          state.profile.goal
        ) || "–Ω–µ —É–∫–∞–∑–∞–Ω–∞"}<br/>
            –†–µ–∂–∏–º: ${ctx}.
          </div>
        `;
      }

      root.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>‚ú®</span> AI-—Å—Ç–∏–ª–∏—Å—Ç ARELEI</div>
              <div class="card-sub">–°–æ–∑–¥–∞—ë—Ç –æ–±—Ä–∞–∑—ã –ø–æ–¥ —Ç–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç, –≥–æ—Ä–æ–¥ –∏ —Ü–µ–ª–∏</div>
            </div>
            <button class="btn btn-primary btn-sm" onclick="setTab('stylist')">
              –û—Ç–∫—Ä—ã—Ç—å —Å—Ç–∏–ª–∏—Å—Ç–∞
            </button>
          </div>
          ${profileLine}
          <div class="ai-block">
            <div class="ai-label">–ò–Ω—Å–∞–π—Ç—ã –ø–æ –≥–∞—Ä–¥–µ—Ä–æ–±—É</div>
            <div class="stat-row">
              <div class="stat">
                <div class="stat-label">–í—Å–µ–≥–æ –≤–µ—â–µ–π</div>
                <div class="stat-value">${total}</div>
                <div class="stat-note">${total === 0 ? "–ø–æ–∫–∞ –ø—É—Å—Ç–æ üëÄ" : "–æ—Ü–∏—Ñ—Ä–æ–≤–∞–Ω–æ üëï"}</div>
              </div>
              <div class="stat">
                <div class="stat-label">–û–±—Ä–∞–∑—ã</div>
                <div class="stat-value">0</div>
                <div class="stat-note">–ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
              </div>
            </div>
            <div class="notes">
              –î–æ–±–∞–≤—å –≤–µ—â–∏ –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ì–∞—Ä–¥–µ—Ä–æ–±¬ª, –∏ ARELEI –Ω–∞—á–Ω—ë—Ç —Å—Ç—Ä–æ–∏—Ç—å –∫–∞–ø—Å—É–ª—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
              –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–¥ —Ç–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å.
            </div>
          </div>
          <div class="quick-row">
            <div class="quick" onclick="setTab('wardrobe')">
              <span class="icon">üëö</span>
              <span>–ì–∞—Ä–¥–µ—Ä–æ–±</span>
            </div>
            <div class="quick" onclick="setTab('ar')">
              <span class="icon">üì∑</span>
              <span>AR –ø—Ä–∏–º–µ—Ä–∫–∞</span>
            </div>
            <div class="quick" onclick="setTab('stylist')">
              <span class="icon">ü§ñ</span>
              <span>–°—Ç–∏–ª–∏—Å—Ç</span>
            </div>
            <div class="quick" onclick="setTab('pro')">
              <span class="icon">üíé</span>
              <span>PRO</span>
            </div>
          </div>
        </div>
      `;
    }

    /* ====== –ì–ê–†–î–ï–†–û–ë ====== */

    function renderWardrobe(root) {
      const items = state.clothes;
      const list =
        items.length === 0
          ? `<div class="notes">–ì–∞—Ä–¥–µ—Ä–æ–± –ø–æ–∫–∞ –ø—É—Å—Ç. –°–¥–µ–ª–∞–π —Ñ–æ—Ç–æ –≤–µ—â–∏ –≤–æ –≤–∫–ª–∞–¥–∫–µ AR –∏–ª–∏ –¥–æ–±–∞–≤—å –≤—Ä—É—á–Ω—É—é.</div>`
          : items
              .map(
                (c, i) => `
              <div class="clothes-item">
                <img class="item-image" src="${c.img}" alt="${c.name}" />
                <div class="clothes-main">
                  <div class="clothes-name">${c.name}</div>
                  <div class="clothes-meta">${c.type || ""} ¬∑ ${c.season || ""}</div>
                  <div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:3px;">
                    <span class="badge">${
                      c.usage === "—Ä–µ–¥–∫–æ" ? "–ø–æ—á—Ç–∏ –Ω–µ –Ω–æ—Å–∏—à—å üò¥" : "–Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–æ—Å–∏—à—å üíö"
                    }</span>
                    ${c.season ? `<span class="chip">${c.season}</span>` : ""}
                    ${
                      c.tags && c.tags.length
                        ? c.tags.map(t => `<span class="chip">${t}</span>`).join("")
                        : ""
                    }
                  </div>
                </div>
                <button class="btn btn-ghost btn-sm" style="padding:4px 7px;font-size:9px;"
                  onclick="deleteClothes(${i})">
                  ‚úï
                </button>
              </div>
            `
              )
              .join("");

      root.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>üëö</span> –ú–æ–π –≥–∞—Ä–¥–µ—Ä–æ–±</div>
              <div class="card-sub">–•—Ä–∞–Ω–∏ –≤–µ—â–∏ –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–º –≤–∏–¥–µ</div>
            </div>
            <button class="btn btn-primary btn-sm" onclick="addClothesManual()">
              + –î–æ–±–∞–≤–∏—Ç—å
            </button>
          </div>
          ${list}
        </div>
      `;
    }

    function addClothesManual() {
      const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—â–∏:", "–ù–æ–≤–∞—è –≤–µ—â—å");
      if (!name) return;
      const type = prompt("–¢–∏–ø (–≤–µ—Ä—Ö, –Ω–∏–∑, –ø–ª–∞—Ç—å–µ...):", "–≤–µ—Ä—Ö");
      const season = prompt("–°–µ–∑–æ–Ω (–∑–∏–º–∞, –ª–µ—Ç–æ, –∫—Ä—É–≥–ª—ã–π –≥–æ–¥...):", "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥");
      const usage = prompt("–ö–∞–∫ —á–∞—Å—Ç–æ –Ω–æ—Å–∏—à—å? (—á–∞—Å—Ç–æ / —Å—Ä–µ–¥–Ω–µ / —Ä–µ–¥–∫–æ):", "—Å—Ä–µ–¥–Ω–µ");
      const tagsRaw = prompt("–¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (—à–∫–æ–ª–∞, –ø—Ä–æ–≥—É–ª–∫–∞...):", "—à–∫–æ–ª–∞");
      const tags = tagsRaw
        ? tagsRaw
            .split(",")
            .map(t => t.trim())
            .filter(Boolean)
        : [];
      const item = {
        name: name,
        type: type || "",
        season: season || "",
        usage: usage || "—Å—Ä–µ–¥–Ω–µ",
        tags: tags,
        img:
          "https://images.pexels.com/photos/7697329/pexels-photo-7697329.jpeg?auto=compress&cs=tinysrgb&w=400"
      };
      state.clothes.unshift(item);
      saveState();
      renderScreen();
    }

    function deleteClothes(index) {
      if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –≤–µ—â—å –∏–∑ –≥–∞—Ä–¥–µ—Ä–æ–±–∞?")) return;
      state.clothes.splice(index, 1);
      saveState();
      renderScreen();
    }

    function addClothesFromPhoto(name, dataUrl) {
      const item = {
        name: name,
        type: "–Ω–µ —É–∫–∞–∑–∞–Ω",
        season: "",
        usage: "–Ω–æ–≤–∞—è",
        tags: ["–¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ AR"],
        img: dataUrl
      };
      state.clothes.unshift(item);
      saveState();
    }

    /* ====== AR ====== */

    function renderAR(root) {
      root.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>üì∑</span> AR-–ø—Ä–∏–º–µ—Ä–∫–∞</div>
              <div class="card-sub">–ö–∞–º–µ—Ä–∞ + –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—â–µ–π –≤ –≥–∞—Ä–¥–µ—Ä–æ–±</div>
            </div>
          </div>

          <video id="arCamera" class="ar-video" autoplay playsinline muted></video>
          <canvas id="arSnapshot" class="ar-photo" style="display:none;margin-top:6px;"></canvas>

          <div class="upload-row">
            <button class="btn btn-primary btn-sm" onclick="startCamera()">–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
            <button class="btn btn-ghost btn-sm" onclick="takePhoto()">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
            <button class="btn btn-ghost btn-sm" onclick="stopCamera()">–í—ã–∫–ª—é—á–∏—Ç—å</button>
          </div>

          <div class="upload-row">
            <input type="file" accept="image/*" id="fileInput" />
            <button class="btn btn-ghost btn-sm" onclick="addFromGallery()">–ò–∑ –≥–∞–ª–µ—Ä–µ–∏</button>
          </div>

          <div class="notes">
            –í –±–æ–µ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Ñ–æ—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ò–ò: –≤—ã—Ä–µ–∑–∞–µ—Ç—Å—è —Ñ–æ–Ω, –≤–µ—â—å —Å—Ç–∞–≤–∏—Ç—Å—è –Ω–∞ –±–µ–ª—ã–π —Ñ–æ–Ω
            –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è 3D-–ø—Ä–∏–º–µ—Ä–∫–∏. –°–µ–π—á–∞—Å —Ñ–æ—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –≥–∞—Ä–¥–µ—Ä–æ–±.
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>üõçÔ∏è</span> –ü–æ–∫—É–ø–∫–∏ —á–µ—Ä–µ–∑ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã</div>
              <div class="card-sub">–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ —Ç–≤–æ–π —Å—Ç–∏–ª—å</div>
            </div>
          </div>
          <div class="discounts">
            ${state.discounts
              .map(
                (d, i) => `
              <div class="discount-card" onclick="openPartner(${i})">
                <div>
                  <div class="discount-brand">${d.brand}</div>
                  <div class="discount-info">${d.offer}</div>
                  <div class="notes">${d.note}</div>
                </div>
                <span class="badge-link">–ø–µ—Ä–µ–π—Ç–∏</span>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
      `;
    }

    function openPartner(index) {
      const d = state.discounts[index];
      alert(
        d.brand +
          "\n\n" +
          d.offer +
          "\n\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ OZON / Wildberries —Å UTM-–º–µ—Ç–∫–∞–º–∏."
      );
    }

    async function startCamera() {
      try {
        const video = document.getElementById("arCamera");
        if (!video) return;
        arStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" }
        });
        video.srcObject = arStream;
      } catch (e) {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.");
        console.error(e);
      }
    }

    function stopCamera() {
      if (arStream) {
        arStream.getTracks().forEach(t => t.stop());
        arStream = null;
      }
    }

    function takePhoto() {
      const video = document.getElementById("arCamera");
      const canvas = document.getElementById("arSnapshot");
      if (!video || !canvas) return;
      if (!video.videoWidth || !video.videoHeight) {
        alert("–°–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É üôÇ");
        return;
      }
      const w = video.videoWidth;
      const h = video.videoHeight;
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, w, h);
      canvas.style.display = "block";

      const save = confirm("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ –∫–∞–∫ –Ω–æ–≤—É—é –≤–µ—â—å?");
      if (!save) return;
      const name = prompt("–ö–∞–∫ –Ω–∞–∑–æ–≤—ë–º —ç—Ç—É –≤–µ—â—å?", "–ù–æ–≤–∞—è –≤–µ—â—å");
      if (!name) return;
      const dataUrl = canvas.toDataURL("image/jpeg");
      addClothesFromPhoto(name, dataUrl);
      alert("–í–µ—â—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –≥–∞—Ä–¥–µ—Ä–æ–±. –û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É ¬´–ì–∞—Ä–¥–µ—Ä–æ–±¬ª, —á—Ç–æ–±—ã –µ—ë —É–≤–∏–¥–µ—Ç—å.");
    }

    function addFromGallery() {
      const input = document.getElementById("fileInput");
      if (!input || !input.files || !input.files[0]) {
        alert("–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏.");
        return;
      }
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—â–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–æ—Ç–æ:", "–í–µ—â—å —Å —Ñ–æ—Ç–æ");
        if (!name) return;
        const dataUrl = e.target.result;
        addClothesFromPhoto(name, dataUrl);
        alert("–§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –≤–µ—â—å –≤ –≥–∞—Ä–¥–µ—Ä–æ–±.");
      };
      reader.readAsDataURL(file);
    }

    /* ====== –ò–ò-–°–¢–ò–õ–ò–°–¢ (–∑–∞–≥–ª—É—à–∫–∞ –ø–æ–¥ GPT) ====== */

    function renderStylist(root) {
      root.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>ü§ñ</span> –ò–ò-—Å—Ç–∏–ª–∏—Å—Ç</div>
              <div class="card-sub">–ü–æ–¥–±–æ—Ä –æ–±—Ä–∞–∑–∞ –ø–æ–¥ –ø–æ–≤–æ–¥ –∏ –ø–æ–≥–æ–¥—É</div>
            </div>
          </div>
          <div class="inputs">
            <div>
              <label for="eventSelect">–ü–æ–≤–æ–¥</label>
              <select id="eventSelect">
                <option value="school">–®–∫–æ–ª–∞ / –∫–æ–ª–ª–µ–¥–∂</option>
                <option value="work">–†–∞–±–æ—Ç–∞ / –æ—Ñ–∏—Å</option>
                <option value="walk">–ü—Ä–æ–≥—É–ª–∫–∞</option>
                <option value="party">–í–µ—á–µ—Ä–∏–Ω–∫–∞</option>
                <option value="date">–°–≤–∏–¥–∞–Ω–∏–µ</option>
              </select>
            </div>
            <div>
              <label for="weatherSelect">–ü–æ–≥–æ–¥–∞</label>
              <select id="weatherSelect">
                <option value="cool">–ü—Ä–æ—Ö–ª–∞–¥–Ω–æ (+5‚Ä¶+10¬∞)</option>
                <option value="warm">–¢–µ–ø–ª–æ (+15‚Ä¶+22¬∞)</option>
                <option value="hot">–ñ–∞—Ä–∫–æ (+25¬∞ –∏ –≤—ã—à–µ)</option>
              </select>
            </div>
            <div>
              <label for="styleInput">–ö–∞–∫ —Ö–æ—á–µ—à—å –≤—ã–≥–ª—è–¥–µ—Ç—å?</label>
              <input id="styleInput" type="text" placeholder="–º–∏–Ω–∏–º–∞–ª–∏–∑–º, —è—Ä–∫–æ, –ø–æ-–¥–µ–ª–æ–≤–æ–º—É..." />
            </div>
          </div>
          <button class="btn btn-primary btn-sm" onclick="generateOutfit()">
            –ü–æ–¥–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ ‚ú®
          </button>

          <div id="stylistResult" class="ai-block" style="margin-top:8px;">
            <div class="ai-label">–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</div>
            <div class="ai-title"><span>‚ú®</span> –û–±—Ä–∞–∑ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</div>
            <div class="ai-text">
              –î–ª—è —à–∫–æ–ª—ã –∏ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –ø–æ–≥–æ–¥—ã: –±–µ–ª–∞—è —Ä—É–±–∞—à–∫–∞, –ø—Ä—è–º—ã–µ –¥–∂–∏–Ω—Å—ã, –±–µ–ª—ã–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
              –∂–∞–∫–µ—Ç ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –∏ —É–¥–æ–±–Ω–æ.
            </div>
            <div class="ai-tags">
              <span class="ai-tag">–¥—Ä–µ—Å—Å-–∫–æ–¥</span>
              <span class="ai-tag">–∫–æ–º—Ñ–æ—Ä—Ç</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>üé®</span> –ê–Ω–∞–ª–∏–∑ —Ü–≤–µ—Ç–æ—Ç–∏–ø–∞ (PRO)</div>
              <div class="card-sub">–ü–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è GPT-–±—ç–∫–µ–Ω–¥–∞</div>
            </div>
            <span class="pill">–ø–æ –ø–æ–¥–ø–∏—Å–∫–µ</span>
          </div>
          <div class="notes">
            –ó–¥–µ—Å—å –ø–æ–∑–∂–µ –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –±—ç–∫–µ–Ω–¥ (Node + GPT): –ø–æ —Ñ–æ—Ç–æ –∏ –∞–Ω–∫–µ—Ç–µ —Å—Ç–∏–ª–∏—Å—Ç –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å —Ü–≤–µ—Ç–æ—Ç–∏–ø,
            –ø–æ–¥–±–∏—Ä–∞—Ç—å –º–∞–∫–∏—è–∂ –∏ –ø—Ä–∏—á—ë—Å–∫—É, —Å—Ç—Ä–æ–∏—Ç—å –∫–∞–ø—Å—É–ª—É –ø–æ–¥ —Ç–µ–±—è.
          </div>
        </div>
      `;
    }

    function generateOutfit() {
      const event = document.getElementById("eventSelect").value;
      const weather = document.getElementById("weatherSelect").value;
      const styleWish = document.getElementById("styleInput").value.trim();
      const result = document.getElementById("stylistResult");

      let text = "";
      let tags = [];

      if (event === "school") {
        if (weather === "cool") {
          text =
            "–î–ª—è —à–∫–æ–ª—ã –∏ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –ø–æ–≥–æ–¥—ã: –±–∞–∑–æ–≤–∞—è —Ä—É–±–∞—à–∫–∞, –ø—Ä—è–º—ã–µ –¥–∂–∏–Ω—Å—ã, –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∂–∞–∫–µ—Ç.";
          tags = ["—à–∫–æ–ª–∞", "—Å–ª–æ–∏—Å—Ç–æ—Å—Ç—å", "–∫–æ–º—Ñ–æ—Ä—Ç"];
        } else if (weather === "warm") {
          text =
            "–¢—ë–ø–ª–∞—è –ø–æ–≥–æ–¥–∞ –∏ —à–∫–æ–ª–∞: –ª—ë–≥–∫–∞—è —Ä—É–±–∞—à–∫–∞ –∏–ª–∏ —Ñ—É—Ç–±–æ–ª–∫–∞, –ø—Ä—è–º—ã–µ –¥–∂–∏–Ω—Å—ã –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ—ë–≤.";
          tags = ["–º–∏–Ω–∏–º–∞–ª–∏–∑–º", "–¥—Ä–µ—Å—Å-–∫–æ–¥"];
        } else {
          text =
            "–ñ–∞—Ä–∫–æ –∏ –¥—Ä–µ—Å—Å-–∫–æ–¥: —Å–≤–µ—Ç–ª–∞—è —Ö–ª–æ–ø–∫–æ–≤–∞—è —Ä—É–±–∞—à–∫–∞ –∏–ª–∏ –ø–ª–∞—Ç—å–µ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π, —É–¥–æ–±–Ω–∞—è –æ–±—É–≤—å.";
          tags = ["–∂–∞—Ä–∞", "–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Ç–∫–∞–Ω–∏"];
        }
      } else if (event === "work") {
        text =
          "–î–ª—è —Ä–∞–±–æ—Ç—ã: —Å—Ç—Ä–æ–≥–∏–π –≤–µ—Ä—Ö (—Ä—É–±–∞—à–∫–∞ –∏–ª–∏ —Ç—Ä–∏–∫–æ—Ç–∞–∂), –ø—Ä—è–º—ã–µ –±—Ä—é–∫–∏ –∏–ª–∏ —Ç—ë–º–Ω—ã–µ –¥–∂–∏–Ω—Å—ã, –∑–∞–∫—Ä—ã—Ç–∞—è –æ–±—É–≤—å. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∂–∞–∫–µ—Ç.";
        tags = ["–æ—Ñ–∏—Å", "–ø–æ-–¥–µ–ª–æ–≤–æ–º—É"];
      } else if (event === "walk") {
        text =
          "–î–ª—è –ø—Ä–æ–≥—É–ª–∫–∏: —É–¥–æ–±–Ω—ã–π —Å–≤–∏—Ç—à–æ—Ç –∏–ª–∏ —Ö—É–¥–∏, —Å–≤–æ–±–æ–¥–Ω—ã–µ –¥–∂–∏–Ω—Å—ã/–±—Ä—é–∫–∏ –∏ –∫—Ä–æ—Å—Å–æ–≤–∫–∏. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–µ–π—Å–±–æ–ª–∫—É –∏ —Ä—é–∫–∑–∞–∫.";
        tags = ["casual", "–∫–æ–º—Ñ–æ—Ä—Ç"];
      } else if (event === "party") {
        text =
          "–ù–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É: –ø–ª–∞—Ç—å–µ –∏–ª–∏ —è—Ä–∫–∏–π –≤–µ—Ä—Ö + –±–∞–∑–æ–≤—ã–π –Ω–∏–∑, –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è –æ–±—É–≤—å –∏ —Å—É–º–∫–∞, –¥–æ–±–∞–≤—å —É–∫—Ä–∞—à–µ–Ω–∏—è.";
        tags = ["–≤–µ—á–µ—Ä–∏–Ω–∫–∞", "–∞–∫—Ü–µ–Ω—Ç"];
      } else if (event === "date") {
        text =
          "–ù–∞ —Å–≤–∏–¥–∞–Ω–∏–µ: –º—è–≥–∫–∏–π —Å–≤–∏—Ç–µ—Ä –∏–ª–∏ —Ç–æ–ø –≤ –ø—Ä–∏—è—Ç–Ω–æ–º –æ—Ç—Ç–µ–Ω–∫–µ, —é–±–∫–∞ –∏–ª–∏ –¥–∂–∏–Ω—Å—ã –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ –±–æ—Ç–∏–Ω–∫–∏/–∫—Ä–æ—Å—Å–æ–≤–∫–∏.";
        tags = ["—Ä–æ–º–∞–Ω—Ç–∏–∫–∞", "–º—è–≥–∫–∏–µ –æ—Ç—Ç–µ–Ω–∫–∏"];
      }

      if (styleWish) {
        text += " –£—á–∏—Ç—ã–≤–∞—é —Ç–≤–æ—ë –ø–æ–∂–µ–ª–∞–Ω–∏–µ: ¬´" + styleWish + "¬ª.";
        tags.push(styleWish);
      }

      result.innerHTML = `
        <div class="ai-label">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å—Ç–∏–ª–∏—Å—Ç–∞</div>
        <div class="ai-title"><span>‚ú®</span> –û–±—Ä–∞–∑ –æ—Ç ARELEI</div>
        <div class="ai-text">${text}</div>
        <div class="ai-tags">
          ${tags.map(t => `<span class="ai-tag">${t}</span>`).join("")}
        </div>
      `;
    }

    /* ====== PRO ====== */

    function renderPro(root) {
      root.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title"><span>üíé</span> ARELEI PRO</div>
              <div class="card-sub">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ò–ò-—Å—Ç–∏–ª–∏—Å—Ç –∏ –±—å—é—Ç–∏-—Ñ—É–Ω–∫—Ü–∏–∏</div>
            </div>
          </div>
          <div class="ai-block">
            <div class="ai-title"><span>üì¶</span> –¢–∞—Ä–∏—Ñ ¬´ARELEI PRO¬ª</div>
            <div class="ai-text">
              <b>399 ‚ÇΩ –≤ –º–µ—Å—è—Ü</b> ‚Äî –∞–Ω–∞–ª–∏–∑ —Ü–≤–µ—Ç–æ—Ç–∏–ø–∞, –ø–æ–¥–±–æ—Ä –º–∞–∫–∏—è–∂–∞ –∏ –ø—Ä–∏—á—ë—Å–∫–∏,
              —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ–±—Ä–∞–∑–æ–≤ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏ —É –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.
            </div>
            <div class="ai-tags">
              <span class="ai-tag">–∞–Ω–∞–ª–∏–∑ –≤–Ω–µ—à–Ω–æ—Å—Ç–∏</span>
              <span class="ai-tag">AR-–±—å—é—Ç–∏</span>
              <span class="ai-tag">—Å–∫–∏–¥–∫–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</span>
            </div>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-primary btn-sm" onclick="startProPayment()">
              –û—Ñ–æ—Ä–º–∏—Ç—å PRO üí≥
            </button>
            <button class="btn btn-ghost btn-sm" onclick="setTab('home')">
              –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
          </div>
          <div class="notes">
            –í –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ —ç—Ç–∞ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç PRO. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç
            –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π –º–µ—Ç–æ–¥.
          </div>
        </div>
      `;
    }

    function startProPayment() {
      state.pro = !state.pro;
      saveState();
      updateStatusBadge();
      alert(
        state.pro
          ? "–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ PRO –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ü–æ—Ç–æ–º —Å—é–¥–∞ –ø–æ–¥–∫–ª—é—á–∏–º —Ä–µ–∞–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É."
          : "PRO –≤—ã–∫–ª—é—á–µ–Ω."
      );
    }

    function updateStatusBadge() {
      const badge = document.getElementById("statusBadge");
      if (state.pro) {
        badge.innerHTML = '<div class="badge-dot"></div> PRO-–ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ üíé';
      } else {
        badge.innerHTML =
          '<div class="badge-dot"></div> Free-–ø–ª–∞–Ω ¬∑ –ò–ò-—Å—Ç–∏–ª–∏—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ ü§ñ';
      }
    }

    /* ====== Telegram init ====== */

    function initTelegramUser() {
      try {
        if (window.Telegram && window.Telegram.WebApp) {
          const data = window.Telegram.WebApp.initDataUnsafe;
          if (data && data.user) {
            const name =
              data.user.first_name +
              (data.user.last_name ? " " + data.user.last_name : "");
            document.getElementById("tgName").textContent = name;
            document.getElementById("tgAvatar").textContent =
              (data.user.first_name || "A").charAt(0).toUpperCase();
          }
        }
      } catch (e) {
        console.error(e);
      }
    }

    /* ====== START ====== */

    document.addEventListener("DOMContentLoaded", function () {
      loadState();
      updateStatusBadge();
      initTelegramUser();

      if (!state.onboarded) {
        state.tab = "home";
        highlightTab("home");
        renderOnboarding(document.getElementById("screen"));
      } else {
        setTab("home");
      }
    });
  </script>
</body>
</html>
